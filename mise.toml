[tools]
bun = "latest"
node = "lts"

[hooks]
postinstall = "bun install"

[vars]
entrypoint = "./src/index.ts"
build_args = '--outdir=dist --sourcemap --splitting --target=browser --clean'

[tasks."build:esm"]
hide = true
run = "bun build {{vars.entrypoint}} {{vars.build_args}} --format=esm"

[tasks."build:cjs"]
hide = true
run = "bun build {{vars.entrypoint}} {{vars.build_args}} --format=cjs --entry-naming=\"[dir]/[name].cjs\""

[tasks."build:worklets"]
hide = true
run = "ls src/worklets/*.ts | xargs bun build {{vars.build_args}} --outdir=dist/worklets"

[tasks."build:dts"]
hide = true
run = "bun x tsgo --project tsconfig.json"

[tasks.clean]
run = "rm -rf ./dist"

[tasks.fix]
run = "bun x biome check --fix"

[tasks.check]
run = "bun x biome check"

[tasks.build]
depends = ["clean"]
run = [{ tasks = ["build:esm", "build:cjs", "build:worklets", "build:dts"] }]

[tasks.test]
depends = ["build", "test:setup"]
run = "bun x playwright test"

[tasks."test:setup"]
run = "bun x playwright install --with-deps"

[tasks."test:ui"]
depends = ["build", "test:setup"]
run = "bun x playwright test --ui"

[tasks."test:headed"]
depends = ["build", "test:setup"]
run = "bun x playwright test --headed"

[tasks."test:debug"]
depends = ["build", "test:setup"]
run = "bun x playwright test --debug"
